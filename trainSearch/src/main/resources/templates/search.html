<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <meta charset="UTF-8">
    <title>Train Catcher</title>
</head>
<body>
    <h2>Search for your next train journey</h2>
    <div class="container-fluid">
        <form id="train-search-form">
            <div class="mb-3">
                <label for="departure" class="form-label">Departure Station</label>
                <select class="form-select" id="departure" aria-label="Departure Station Select">
                    <option selected="Enschede">Enschede</option>
                    <option value="Hengelo">Hengelo</option>
                    <option value="Zwolle">Zwolle</option>
                    <option value="Amsterdam">Amsterdam</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="arrival" class="form-label">Arrival Station</label>
                <select class="form-select" id="arrival" aria-label="Arrival Station Select">
                    <option value="Enschede">Enschede</option>
                    <option value="Hengelo">Hengelo</option>
                    <option value="Zwolle">Zwolle</option>
                    <option selected="Amsterdam">Amsterdam</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="departure-time" class="form-label">Choose a departure time</label>
                <input class="form-control" type="datetime-local" id="departure-time" name="departure-time">
            </div>
            <div class="mb-3">
                <label for="max-changes" class="form-label">Max Changes</label>
                <select class="form-select" id="max-changes" aria-label="Max Changes Select">
                    <option th:each="idx : ${#numbers.sequence(0, 5)}" th:value="${idx}" th:text="${idx}"></option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Search</button>
        </form>
    </div>
</body>
<script th:inline="javascript">
    const form = document.querySelector("#train-search-form");

    async function sendForm() {
        const queryParams = {
            "departure_station": document.querySelector('#departure').value,
            "arrival_station": document.querySelector('#arrival').value,
            "departure_time": document.querySelector('#departure-time').value,
            "fetchDelayed": false,
            "max-changes": document.querySelector('#max-changes').value
        }
        const queryUrl = new URLSearchParams(queryParams);
        window.location.href = "/routes?" + queryUrl;
        // try {
        //     const response = await fetch("/search/routes?" + queryUrl, {
        //         method: "GET",
        //     });
        //     const data = await response.json();
        //     console.log(data);
        // } catch (e) {
        //     console.error(e);
        // }
    }

    form.addEventListener("submit", (event) => {
        event.preventDefault();
        sendForm();
    })
</script>
</html>